/** Oslo JavaScript Framework. */
define(["../util/util","../events/util","../events/target","../events/eventtype","./event","../asserts/asserts"],function(a,b,c,d,e,f){"use strict";function g(a,e){c.call(this),f.assert(g.isSupported(a),"HTML5 history is not supported."),this.window_=a||window,this.transformer_=e||null,b.listen(this.window_,d.POPSTATE,this.onHistoryEvent_,!1,this),b.listen(this.window_,d.HASHCHANGE,this.onHistoryEvent_,!1,this)}return a.inherits(g,c),g.isSupported=function(a){var b=a||window;return!(!b.history||!b.history.pushState)},g.prototype.enabled_=!1,g.prototype.useFragment_=!0,g.prototype.pathPrefix_="/",g.prototype.setEnabled=function(a){a!==this.enabled_&&(this.enabled_=a,a&&this.dispatchEvent(new e(this.getToken(),!1)))},g.prototype.getToken=function(){if(this.useFragment_){var a=this.window_.location.href,b=a.indexOf("#");return 0>b?"":a.substring(b+1)}return this.transformer_?this.transformer_.retrieveToken(this.pathPrefix_,this.window_.location):this.window_.location.pathname.substr(this.pathPrefix_.length)},g.prototype.setToken=function(a,b){a!==this.getToken()&&(this.window_.history.pushState(null,b||this.window_.document.title||"",this.getUrl_(a)),this.dispatchEvent(new e(a,!1)))},g.prototype.replaceToken=function(a,b){this.window_.history.replaceState(null,b||this.window_.document.title||"",this.getUrl_(a)),this.dispatchEvent(new e(a,!1))},g.prototype.disposeInternal=function(){b.unlisten(this.window_,d.POPSTATE,this.onHistoryEvent_,!1,this),this.useFragment_&&b.unlisten(this.window_,d.HASHCHANGE,this.onHistoryEvent_,!1,this)},g.prototype.setUseFragment=function(a){this.useFragment_!==a&&(a?b.listen(this.window_,d.HASHCHANGE,this.onHistoryEvent_,!1,this):b.unlisten(this.window_,d.HASHCHANGE,this.onHistoryEvent_,!1,this),this.useFragment_=a)},g.prototype.setPathPrefix=function(a){this.pathPrefix_=a},g.prototype.getPathPrefix=function(){return this.pathPrefix_},g.prototype.getUrl_=function(a){return this.useFragment_?"#"+a:this.transformer_?this.transformer_.createUrl(a,this.pathPrefix_,this.window_.location):this.pathPrefix_+a+this.window_.location.search},g.prototype.onHistoryEvent_=function(){this.enabled_&&this.dispatchEvent(new e(this.getToken(),!0))},g.TokenTransformer=function(){},g.TokenTransformer.prototype.retrieveToken=function(){},g.TokenTransformer.prototype.createUrl=function(){},g});