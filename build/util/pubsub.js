/** Oslo JavaScript Framework. */
goog.provide("goog.pubsub.PubSub"),goog.require("goog.Disposable"),goog.require("goog.array"),goog.pubsub.PubSub=function(){goog.Disposable.call(this),this.subscriptions_=[],this.topics_={}},goog.inherits(goog.pubsub.PubSub,goog.Disposable),goog.pubsub.PubSub.prototype.subscriptions_,goog.pubsub.PubSub.prototype.key_=1,goog.pubsub.PubSub.prototype.topics_,goog.pubsub.PubSub.prototype.pendingKeys_,goog.pubsub.PubSub.prototype.publishDepth_=0,goog.pubsub.PubSub.prototype.subscribe=function(a,b,c){var d=this.topics_[a];d||(d=this.topics_[a]=[]);var e=this.key_;return this.subscriptions_[e]=a,this.subscriptions_[e+1]=b,this.subscriptions_[e+2]=c,this.key_=e+3,d.push(e),e},goog.pubsub.PubSub.prototype.subscribeOnce=function(a,b,c){var d=this.subscribe(a,function(){b.apply(c,arguments),this.unsubscribeByKey(d)},this);return d},goog.pubsub.PubSub.prototype.unsubscribe=function(a,b,c){var d=this.topics_[a];if(d){var e=this.subscriptions_,f=goog.array.find(d,function(a){return e[a+1]==b&&e[a+2]==c});if(f)return this.unsubscribeByKey(f)}return!1},goog.pubsub.PubSub.prototype.unsubscribeByKey=function(a){if(0!=this.publishDepth_)return this.pendingKeys_||(this.pendingKeys_=[]),this.pendingKeys_.push(a),!1;var b=this.subscriptions_[a];if(b){var c=this.topics_[b];c&&goog.array.remove(c,a),delete this.subscriptions_[a],delete this.subscriptions_[a+1],delete this.subscriptions_[a+2]}return!!b},goog.pubsub.PubSub.prototype.publish=function(a){var b=this.topics_[a];if(b){this.publishDepth_++;for(var c=goog.array.slice(arguments,1),d=0,e=b.length;e>d;d++){var f=b[d];this.subscriptions_[f+1].apply(this.subscriptions_[f+2],c)}if(this.publishDepth_--,this.pendingKeys_&&0==this.publishDepth_)for(var g;g=this.pendingKeys_.pop();)this.unsubscribeByKey(g);return 0!=d}return!1},goog.pubsub.PubSub.prototype.clear=function(a){if(a){var b=this.topics_[a];b&&(goog.array.forEach(b,this.unsubscribeByKey,this),delete this.topics_[a])}else this.subscriptions_.length=0,this.topics_={}},goog.pubsub.PubSub.prototype.getCount=function(a){if(a){var b=this.topics_[a];return b?b.length:0}var c=0;for(var d in this.topics_)c+=this.getCount(d);return c},goog.pubsub.PubSub.prototype.disposeInternal=function(){goog.pubsub.PubSub.superClass_.disposeInternal.call(this),delete this.subscriptions_,delete this.topics_,delete this.pendingKeys_};